{% extends 'index_template.html' %}

{% block content %}

<div class="mdl-grid">
    <script type="text/javascript">
        function changeSelection(selected) {
            var option1 = document.getElementById("upload")
            var option2 = document.getElementById("youtube")

            if (selected === 1) {
                option1.style.display = "block";
                option2.style.display = "none";
            }
            else {
                option1.style.display = "none";
                option2.style.display = "block";
            }
        }

        function loadingSpinner() {
            var spinner = document.getElementById("spinner");
            spinner.style.display = "block";
        }


        $(document).ready(function() {
            $('#form').submit(function(e) {
                e.preventDefault();

                fetch($(this).attr('action'), {
                    body: $(this).serialize(),
                    method: $(this).attr('method'),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                })
                .then(response => response.blob())
                .then(response => {
                    if (response.type === 'video/mp4'){
                        const blob = new Blob([response], {type: 'video/mp4'});
                        const downloadUrl = URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.style.display = 'none';
                        a.href = downloadUrl;
                        a.download = "stabilized.mp4";
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a)
                    }

                    document.getElementById("spinner").style.display = "none";
                })

                return false;
            });
        });
    </script>
    <form id="form" action="/upload-video" method="POST" enctype="multipart/form-data">
        <div class="file-uploader mdl-color--white mdl-shadow--3dp mdl-cell mdl-cell--12-col mdl-grid">
            <h5 class="mdl-card__title mdl-color-text--grey-700"><b>Choose a Video</b></h5>

            <div class="mdl-card__actions mdl-card--border">
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="video-option-1">
                  <input type="radio" onClick="changeSelection(1)" id="video-option-1" class="mdl-radio__button" name="options" value="1" checked>
                  <span class="mdl-radio__label">Upload</span>
                </label>
                <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="video-option-2">
                  <input type="radio" onClick="changeSelection(2)" id="video-option-2" class="mdl-radio__button" name="options" value="2">
                  <span class="mdl-radio__label">YouTube</span>
                </label>
            </div>
            <div class="mdl-cell"></div>
            <div id="upload" class="mdl-card__actions">
                <label> Select a Video: </label>
                <input type="file" name="video" value="" id="video"></input>
            </div>

            <div id="youtube" class="mdl-card__actions" style="display:none">
                <label> YouTube URL </label>
                <input type="text" name="video-url" value=""></input>
            </div>
        </div>
        <div class="stable-slider mdl-color--white mdl-shadow--3dp mdl-cell mdl-cell--12-col mdl-grid">
            <h5 class="mdl-card__title mdl-color-text--grey-700"><b> Select Cropping Percentage </b></h5>

            <div class="mdl-card__actions mdl-card--border">
                <div class="mdl-layout__header-row">
                <label>0%</label>
                <input type="range" min="0" max="80" value="10" class="mdl-slider mdl-js-slider" name="crop_percentage" id="crop_percentage">
                <label>80%</label>
                </div>
            </div>
            <div class="mdl-card__supporting-text mdl-color-text--grey-600">
                <label>*The stabilization process creates black borders from warping the frames. Cropping the video reduces these black borders, but will decrease overall resolution of the video</label>
                <br></br>
            </div>
        </div>
        <div class="md1-cell mdl-grid">

            <button type="submit" onClick="loadingSpinner()" name="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-color--accent mdl-color-text--white">
                Stabilize!
            </button>
            <!-- MDL Spinner Component -->
            <div id="spinner" class="mdl-cell" style="display:none">
                <div class="mdl-spinner mdl-js-spinner is-active"></div>
            </div>
        </div>
    </form>
</div>

{% endblock %}
